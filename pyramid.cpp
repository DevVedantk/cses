#include <bits/stdc++.h> #define int long long #define endl '\n' using namespace std; struct Node{ int sum=0; Node* left=NULL; Node* right=NULL; }; Node* buildt(int l,int r){ if(l==r){ Node* leaf=new Node(); leaf->sum=0; return leaf; } int mid=(l+r)/2; Node* node=new Node(); node->left=buildt(l,mid); node->right=buildt(mid+1,r); node->sum=(node->left->sum + node->right->sum); return node; } Node* update(int l,int r,Node* past,int idx){ if(l==r){ Node* leaf=new Node(); leaf->sum+=1; return leaf; } int mid=(l+r)/2; Node* node=new Node(); if(idx<=mid){ //go left; node->left=update(l,mid,past->left,idx); node->right=past->right; node->sum=node->left->sum+node->right->sum; return node; } else{ //go right node->right=update(mid+1,r,past->right,idx); node->left=past->left; node->sum=node->left->sum+node->right->sum; return node; } } int query(int st,int en,int l,int r,Node* node){ if(st>r || l>en) return 0; if(l>=st && r<=en) return node->sum; int mid=(l+r)/2; int left=query(st,en,l,mid,node->left); int right=query(st,en,mid+1,r,node->right); return left+right; } signed main(){ ios::sync_with_stdio(false); cin.tie(NULL); int n,q; cin >> n >> q; vector<int>arr(n); map<int,int>mp; for(int i=0;i<n;i++){ cin >> arr[i]; mp[arr[i]]; } int que[q][4]; for(int i=0;i<q;i++){ int a,b,c,d; cin >> a >> b >> c >> d; que[i][0]=a; que[i][1]=b; que[i][2]=c; que[i][3]=d; mp[c]; mp[d]; } int cnt=0; for(auto &ele:mp){ ele.second=cnt; cnt++; } for(int i=0;i<n;i++) arr[i]=mp[arr[i]]; vector<Node*>list; Node* root=buildt(0,cnt-1); list.push_back(root); for(int i=0;i<n;i++){ int size=list.size(); Node* new_root=update(0,cnt-1,list[size-1],arr[i]); list.push_back(new_root); } // for(auto ele:mp) cout << ele.first << " " << ele.second << endl; for(int i=0;i<q;i++){ int a=que[i][0],b=que[i][1],c=que[i][2],d=que[i][3]; a--; b--; c=mp[c]; d=mp[d]; int total=(b-a+1); //complete range int ele1=query(d+1,cnt-1,0,cnt-1,list[b+1]); int ele2=query(d+1,cnt-1,0,cnt-1,list[a]); cout << c << " " <<d << endl; cout << "ele1 " << ele1 << " " << "ele2 " <<ele2 << endl; total-=(ele1-ele2); ele1=query(0,c-1,0,cnt-1,list[b+1]); ele2=query(0,c-1,0,cnt-1,list[a]); cout <<"phase2 "; cout << "ele1 " << ele1 << " " << "ele2 " <<ele2 << endl; total-=(ele1-ele2); cout << total << endl; } // cout << "hello"; }